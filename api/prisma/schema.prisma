// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

/* =========================
   ENUMS
========================= */

enum Role {
  ADMIN
  USER
}

enum AssetStatus {
  ACTIVE
  IN_REPAIR
  RETIRED
  LOST
}

/* =========================
   MODELS
========================= */

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  name          String?
  passwordHash  String
  role          Role     @default(USER)

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  assets        Asset[]  @relation("UserAssets")
  events        AssetEvent[]
}

model Asset {
  id          String      @id @default(cuid())
  tag         String      @unique
  name        String
  type        String
  status      AssetStatus @default(ACTIVE)

  ownerId     String?
  owner       User?       @relation("UserAssets", fields: [ownerId], references: [id])

  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  events      AssetEvent[]
}

model AssetEvent {
  id            String      @id @default(cuid())

  assetId       String
  asset         Asset       @relation(fields: [assetId], references: [id])

  // snapshot at event time
  assetTag      String
  assetName     String
  assetType     String
  assetStatus   AssetStatus

  action        String
  meta          Json?

  createdBy     String?
  user          User?       @relation(fields: [createdBy], references: [id])

  createdAt     DateTime    @default(now())
}
